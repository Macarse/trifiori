<? if (isset($this->error)) { ?>
    <div class="error"><?= $this->error ?></div>
            <? } ?>
            <? if (isset($this->message)) { ?>
                <? foreach ($this->message as $msg) { ?>
                    <div class="msg"><?= $msg ?></div>
                            <? } ?>
                            <? } ?>
<div class="busqueda">
    <?= $this->puertoSearchForm ?>
</div>
<div id="divmap"></div>
<div id="test"></div>
<div id="divlistado" class="clistado">
	<table id="tablelist">
    <thead>
        <tr>
        <th><?= $this->language->_("Nombre")?></th>
        <th><?= $this->language->_("Ubicación")?></th>
        <th><?= $this->language->_("Mapa")?></th>
        <th><?= $this->language->_("Modificar")?></th>
        <th><?= $this->language->_("Eliminar")?></th></tr>
    </thead>
    <tbody>
    <? if (count($this->paginator)) { ?>
        <? foreach($this->paginator as $puerto) { ?>
        <tr> 
            <td> <?= $puerto->name() ?> </td>
            <td> <?= $puerto->ubicacion() ?> </td>
	    <td> <a href="#" onclick="showMap(<?= $puerto->latitud() ?>,<?= $puerto->longitud() ?>);">Ver Mapa</a> </td>
            <td>
                <a href="<?= "/user/puertos/modpuertos/id/" . $puerto->id() ?>">Modificar</a>
            </td>
            <td>
                <a href="<?= "/user/puertos/removepuertos/id/" . $puerto->id() ?>">Eliminar</a>
            </td>
        </tr>
        <? } ?>
    <? } ?>
    </tbody>
</table>
</div>

<?php if (count($this->paginator)) { ?>
    <?= $this->paginationControl($this->paginator, 'Sliding', 'paginationControl.phtml'); ?>
<?php } ?>

<div id="dt-options"><a id="dt-options-link" href="fallbacklink.html">Table Options</a></div>
<div id="columnshowhide"></div>

<div id="dt-dlg">
    <span class="corner_tr"></span>
    <span class="corner_tl"></span>
    <span class="corner_br"></span>
    <span class="corner_bl"></span>
    <div class="hd">
        Seleccione que columas desea ver:
    </div>
    <div id="dt-dlg-picker" class="bd">
    </div>
</div>

<script type="text/javascript">
YAHOO.util.Event.addListener(window, "load", function() {
    YAHOO.example.EnhanceFromMarkup = new function() {
        var myColumnDefs = [
            {key:"name",label:"<?= $this->language->_("Nombre")?>", sortable:true},
            {key:"ubicacion",label:"<?= $this->language->_("Ubicación")?>", sortable:true},
	{key:"mapa",label:"<?= $this->language->_("Mapa")?>", sortable:true},
        {key:"mod",label:"<?= $this->language->_("Modificar")?>", sortable:false},
        {key:"elim",label:"<?= $this->language->_("Eliminar")?>", sortable:false}
        ];

        this.myDataSource = new YAHOO.util.DataSource(YAHOO.util.Dom.get("tablelist"));
        this.myDataSource.responseType = YAHOO.util.DataSource.TYPE_HTMLTABLE;
        this.myDataSource.responseSchema = {
            fields: [
                    {key:"name"},
                    {key:"ubicacion"},
		    {key:"mapa"},
                    {key:"mod"},
                    {key:"elim"}
                    ]
	        };

        var myDT = this.myDataTable = new YAHOO.widget.DataTable("divlistado", myColumnDefs, this.myDataSource,
                {sortedBy:{key:"name",dir:"desc"},draggableColumns:true});
        // Shows dialog, creating one when necessary
        this.newCols = true;
        this.showDlg = function(e) {
            YAHOO.util.Event.stopEvent(e);

            if(this.newCols) {
                // Populate Dialog
                // Using a template to create elements for the SimpleDialog
                var allColumns = myDT.getColumnSet().keys;
                var elPicker = YAHOO.util.Dom.get("dt-dlg-picker");
                var elTemplateCol = document.createElement("div");
                YAHOO.util.Dom.addClass(elTemplateCol, "dt-dlg-pickercol");
                var elTemplateKey = elTemplateCol.appendChild(document.createElement("span"));
                YAHOO.util.Dom.addClass(elTemplateKey, "dt-dlg-pickerkey");
                var elTemplateBtns = elTemplateCol.appendChild(document.createElement("span"));
                YAHOO.util.Dom.addClass(elTemplateBtns, "dt-dlg-pickerbtns");
                var onclickObj = {fn:this.handleButtonClick, obj:this, scope:false };
                
                // Create one section in the SimpleDialog for each Column
                var elColumn, elKey, elButton, oButtonGrp;
                for(var i=0,l=allColumns.length;i<l;i++) {
                    var oColumn = allColumns[i];
                    
                    // Use the template
                    elColumn = elTemplateCol.cloneNode(true);
                    
                    // Write the Column key
                    elKey = elColumn.firstChild;
                    elKey.innerHTML = oColumn.label;
                    
                    // Create a ButtonGroup
                    oButtonGrp = new YAHOO.widget.ButtonGroup({ 
                                    id: "buttongrp"+i, 
                                    name: oColumn.getKey(), 
                                    container: elKey.nextSibling
                    });
                    oButtonGrp.addButtons([
                        { label: "Visible", value: "Show", checked: ((!oColumn.hidden)), onclick: onclickObj},
                        { label: "Oculto", value: "Hide", checked: ((oColumn.hidden)), onclick: onclickObj}
                    ]);
                                    
                    elPicker.appendChild(elColumn);
                }
                this.newCols = false;
        	}
            this.myDlg.show();
            this.myDlg.center();
        };
        this.hideDlg = function(e) {
            this.hide();
        };
        this.handleButtonClick = function(e, oSelf) {
            var sKey = this.get("name");
            if(this.get("value") === "Hide") {
                // Hides a Column
                oSelf.myDataTable.hideColumn(sKey);
            }
            else {
                // Shows a Column
                oSelf.myDataTable.showColumn(sKey);
            }
        };
        
        // Create the SimpleDialog
        YAHOO.util.Dom.removeClass("dt-dlg", "inprogress");
        this.myDlg = new YAHOO.widget.SimpleDialog("dt-dlg", {
                width: "30em",
			    visible: false,
			    modal: true,
			    buttons: [ 
					{ text:"Cerrar",  handler:this.hideDlg }
                ]
		});
		this.myDlg.render();

        // Nulls out myDlg to force a new one to be created
        myDT.subscribe("columnReorderEvent", function(){
            this.newCols = true;
            YAHOO.util.Event.purgeElement("dt-dlg-picker", true);
            YAHOO.util.Dom.get("dt-dlg-picker").innerHTML = "";
        }, this, true);
		
	// Hook up the SimpleDialog to the link
	YAHOO.util.Event.addListener("dt-options-link", "click", this.showDlg, this, true);
    };
});
</script>
